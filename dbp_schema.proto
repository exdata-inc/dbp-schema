syntax = "proto3";

package dbp_schema;

//option go_package="github.com/synerex/proto_json";

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/wrappers.proto";

message RealWorldDataset {                                      // JSON-LD representing a real-world dataset (subclass of: "schema:Dataset")
    optional string id = 1;                                     // URL of itself (this JSON-LD)
    optional string name = 2;                                   // Name
    optional string url = 3;                                    // URL (unused)
    optional RealWorldDataFieldProfile structureInfo = 4;       // Structural information
    repeated RealWorldDataset generatedFrom = 5;                // Dataset from which this dataset was generated (input dataset during brewing)
    optional RealWorldDataBrewerInfo generatedUsing = 6;        // Brewing program used to create this dataset
    repeated RealWorldDataBrewingArgument generatedArgs = 7;    // Parameters used when creating this dataset (input parameters during brewing)
    optional RealWorldDataCollectionInfo collectionInfo = 8;    // Collection information
    repeated RealWorldDataStoringInfo distribution = 9;         // Data storage locations (repeated because data may be stored in multiple locations depending on retention period)
    optional string author = 10;                                // Entity collecting the data
    optional string contentLocation = 11;                       // Location where the data is collected
    optional google.protobuf.Timestamp dateCreated = 12;        // Timestamp when data collection started
    optional google.protobuf.Timestamp dateModified = 13;       // Timestamp when the most recent data collection began
    optional google.protobuf.Timestamp datePublished = 14;      // Timestamp when the data was published
    optional string license = 15;                               // License
    optional string locationCreated = 16;
    optional string description = 17;                           // Description
    repeated RealWorldDataTags tags = 18;
}

message RealWorldDataBrewerInput {                                      // JSON-LD representing the specification of input data for real-world data brewing
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string key = 4;                                            // Key (name) of the brewing input argument
    optional string inputType = 5;                                      // Type of the brewing input data
    optional bytes value = 6;                                           // Value of the brewing input (used when sending Demand)
    optional VariableCharacteristicEnumeration inputCharacteristic = 7; // A characteristic of an input data entry in a real world dataset.
    optional RealWorldDataset dataset = 8;                              // Target dataset
    repeated RealWorldDataTags tags = 9;
}

message RealWorldDataBrewerOutput {                                         // JSON-LD representing the specification of output data for real-world data brewing
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string key = 4;
    optional string outputType = 5;                                         // A type of an output data entry in a real world dataset.
    optional bytes value = 6;
    optional VariableCharacteristicEnumeration outputCharacteristic = 7;    // A characteristic of an output data entry in a real world dataset.
    repeated RealWorldDataTags tags = 8;
}

message RealWorldDataBrewingArgument {  // An argument that was passed to a brewer to generate a dataset from another.
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string key = 4;
    optional string argumentType = 5;   // A type of an argument passed to a brewer.
    optional bytes value = 6;
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataBrewerInfo {                                               // JSON-LD representing the specification of the brewer (microprogram) used in real-world data brewing
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    repeated RealWorldDataBrewerInput inputSpecs = 4;
    repeated RealWorldDataBrewerOutput outputSpecs = 5;
    repeated RealWorldDataBrewingArgument argSpecs = 6;
    optional ConversionCharacteristicEnumeration conversionCharacteristic = 7;  // A characteristic of a conversion done by the brewer.
    repeated RealWorldDataTags tags = 8;
}

enum ConversionCharacteristicEnumeration {      // Enumerates conversion characteristics, such as single-value-replace, col-merge, or row-merge.
    // option allow_alias = true;
    SINGLE_VALUE_REPLACE = 0;
    COL_MERGE = 1;
    ROW_MERGE = 2;
}

enum VariableCharacteristicEnumeration {        // Enumerates value characteristics, such as qualitative or quantitative.
    // option allow_alias = true;
    QUALITATIVE = 0;
    QUANTITATIVE = 1;
}

message RealWorldDataCollectionInfo {           // Information for collecting real-world data.
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string collectionStyle = 4;        // A style of data collection (Server, Client, Pub/Sub).
    optional string collectionProtocol = 5;     // A protocol of data collection (HTTP, HTTPS, FTP, etc.).
    optional string listenAddress = 6;          // A listening address for data collection (URL).
    optional string serverAddress = 7;          // A server address for data collection (URL).
    optional EntryPoint entryPoint = 8;         // An entry point for data collection (action_application, URL).
    repeated RealWorldDataTags tags = 9;
}

message EntryPoint {  // https://schema.org/EntryPoint
    optional string actionApplication = 1;
    optional string actionPlatform = 2;
    optional string contentType = 3;
    optional string encodingType = 4;
    optional string httpMethod = 5;
    optional string urlTemplate = 6;
    optional string additionalType = 7;
    optional string alternateName = 8;
    optional string description = 9;
    optional string disambiguatingDescription = 10;
    optional string id = 11;
    optional string image = 12;
    optional string mainEntityOfPage = 13;
    optional string name = 14;
    optional string potentialAction = 15;
    optional string sameAs = 16;
    optional string subjectOf = 17;
    optional string url = 18;
}

message Thing {  // https://schema.org/Thing
    optional string additionalType = 1;
    optional string alternateName = 2;
    optional string description = 3;
    optional string disambiguatingDescription = 4;
    optional string id = 5;
    optional string image = 6;
    optional string mainEntityOfPage = 7;
    optional string name = 8;
    optional string potentialAction = 9;
    optional string sameAs = 10;
    optional string subjectOf = 11;
    optional string url = 12;
}

message RealWorldDataBrewEvent {

}

message RealWorldDataFieldProfile {        // JSON-LD representing a real-world data field profile
    // JSON-LD basic
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;

    // structure as JSON-LD schema
    optional RealWorldDataStructureGraph structure = 10;     // JSON-LD schema (including @graph)

    // Original data format related
    optional string encodingFormat = 20;    // schema.org's schema:encodingFormat (file MIME type)
    optional string newLineCharacter = 21;  // Newline character in the file
    optional string textEncoding = 22;      // Character encoding in the file

    // Compression related
    optional string rwdProfileGeneratorVersion = 30;    // SemantiPack version used for metadata generation
    optional string semantiPackVersion = 31;            // SemantiPack version used for compression

    // JSON related
    optional bool jsonHasIndent = 40;           // Whether JSON file has indentation
    optional string jsonIndentCharacter = 41;   // Indent character string for JSON file with indentation

    // CSV related
    optional bool csvHasHeader = 50;                            // Whether CSV file has header
    optional string csvQuoting = 51;                            // CSV quoting format (usage of ")
    optional string csvSeparator = 52;                          // CSV separator character
    optional bool csvVariableColumnsStripTrailingCommas = 53;   // Whether trailing columns can be omitted per row in CSV (when trailing column data is empty)

    // Others
    optional string graphqlSchema = 60;     // GraphQL schema
    optional string dateCreated = 70;       // Date and time when structural information was created
    repeated RealWorldDataTags tags = 80;
}

message RealWorldDataStructureGraph {   // JSON-LD representing the structure of real-world data
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    repeated GraphNode at_graph = 4;    // JSON-LD schema (@graph)
    repeated RealWorldDataTags tags = 5;
}

message GraphNode {      // JSON-LD schema (contents of @graph)
    oneof node {
        DbpClass classNode = 1;
        DbpList listNode = 2;
        RealWorldDataStructureProperty propertyNode = 3;
    }
}

message IdRef {         // Node referencing schema.org's @id
    optional string id = 1;
}

message DbpClass {                              // Extension of rdfs:Class (subclass of: "rdfs:Class")
    optional string id = 1;
    optional string label = 2;                  // rdfs:label
    optional int32 dbpaCompressRowID = 3;       // Row structure ID when compressing with SemantiPack (matches list ID)
    repeated IdRef domainIncludes = 4;          // schema:domainIncludes
    repeated IdRef rangeIncludes = 5;           // schema:rangeIncludes
}

message DbpList {                               // Extension of rdf:List (subclass of: "rdf:List")
    optional string id = 1;
    optional string label = 2;                  // rdfs:label
    optional bool dbpaCompress = 3;             // Whether to compress the list structure with SemantiPack
    optional int32 dbpaCompressListID = 4;      // List structure ID when compressing with SemantiPack (matches row ID)
    repeated int32 dbpaChildrenLists = 5;       // List of child list IDs when child lists exist during SemantiPack compression
    repeated IdRef domainIncludes = 6;          // schema:domainIncludes
    repeated IdRef rangeIncludes = 7;           // schema:rangeIncludes
}

message RealWorldDataStructureProperty {    // Class for describing data metadata in JSON-LD
    // JSON-LD basic
    optional string id = 1;
    optional string label = 2;              // rdfs:label
    optional string comment = 3;            // rdfs:comment Comment describing the contents of data field
    optional string rdfsSubPropertyOf = 4;  // rdfs:subPropertyOf Corresponding item on schema.org

    // Relations (domain / range)
    repeated IdRef domainIncludes = 10;     // schema:domainIncludes
    repeated IdRef rangeIncludes = 11;      // schema:rangeIncludes

    // Compression metadata
    optional int32 dbpaCompressParentListId = 20;   // List structure ID assigned to columns during SemantiPack compression (matches row ID)
    optional int32 dbpaCompressColumnId = 21;       // Column structure ID during SemantiPack compression
    optional int32 dbpaDiffNumBytes = 22;           // Number of bytes used to represent differential values during differential compression
    optional int32 dbpaFirstNumBytes = 23;          // Number of bytes used to represent the first value during differential compression
    optional bool StripTrailingZeros = 24;          // Whether to strip trailing zeros in decimals
    optional bool UseRunLength = 25;                // Whether run-length compression should be used

    // Type related
    optional ItemType itemType = 30;        // Semantic type of data
    optional ItemType itemType95p = 31;     // Semantic type satisfied by 95% or more of the data

    // Unit
    optional google.protobuf.StringValue unitText = 40;     // Value representing the unit of the variable (unece.org Rec 20 value)

    // Variable characteristics
    optional VariableCharacteristic VariableCharacteristicEnumeration = 50;  // Enum value representing the scale of the variable

    // Boolean metadata
    optional bool isMostlyConstant = 60;        // Whether the data field is mostly constant
    optional bool isEnumValue = 61;             // Whether the data field is an enum value
    optional bool isMostlyIncremental = 62;     // Whether the data field is mostly monotonically increasing
    optional bool isNullable = 63;              // Whether empty strings or null values may exist for numeric or datetime types
    optional bool isOptional = 64;              // Indicates that the data field may not exist

    // Datetime metadata
    optional string dbpaDatetimeFormat = 70;                    // Format string when the data field is of datetime type
    optional string dbpaDatetimePrecision = 71;                 // Minimum unit when the data field is of datetime type (string equivalent to @schema:unitText)
    optional int32 dbpaDatetimeDiffBytes = 72;                  // Number of bytes used to represent differences when the data field is of datetime type
    optional int32 dbpaDateTimeFormatOffset = 73;               // Timezone offset value for date/time used during compression
    optional bool dbpaDateTimeFormatUtcIsUTCinRFC3339 = 74;     // Whether to represent UTC±0 timezone as UTC in RFC3339-compliant date/time format
    optional bool dbpaDateTimeFormatUtcIsZinRFC3339 = 75;       // Whether to represent UTC±0 timezone as Z in RFC3339-compliant date/time format

    // Numeric range etc
    optional string RangeMin = 80;          // Minimum value of numeric range
    optional string RangeMax = 81;          // Maximum value of numeric range
    optional int32 PrecisionBytes = 82;     // Number of bytes used for numeric representation during compression
    optional int32 DecimalPlaces = 83;      // How many decimal places to retain when compressing float values
    optional string BaseIncrement = 84;     // Most frequent value of differences when data field is monotonically increasing
    optional bool UseBaseIncrement = 85;    // Whether the most frequent value of differences should be used for compression when data field is monotonically increasing

    // Value samples and enumerated values
    repeated string valueSamples = 90;  // Used to pass value samples to LLM API during compression (non-enum)
    repeated string enumList = 91;      // Used to pass list of enum values to LLM API during compression
}

enum ItemType {       // Enum representing semantic type of data (maximum string length for STRING is not represented)
    INTEGER = 0;
    FLOAT = 1;
    STRING = 2;
    BOOLEAN = 3;
    DATE = 4;
    TIME = 5;
    DATETIME = 6;
    NULL = 7;
}

enum VariableCharacteristic {    // Enum representing variable scale
    NOMINAL = 0;
    ORDINAL = 1;
    INTERVAL = 2;
    PROPORTIONAL = 3;
}

message RealWorldDataStoringInfo {          // JSON-LD representing the storage information for real-world data
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional google.protobuf.Timestamp startTime = 4;
    optional google.protobuf.Timestamp endTime = 5;
    optional string baseUrl = 6;            // URL of the file system or database
    optional string pattern = 7;            // If file system, the pattern following the URL; if database, the pattern for specifying date/time in queries
    optional int32 transmissionSpeed = 8;   // Transfer speed of the storage
    optional string storageType = 9;        // Type of storage (e.g., SSD, HDD, optical disc, magnetic tape, etc.)
    optional EntryPoint entryPoint = 10;    // HTTP entry point (see schema:EntryPoint)
    optional string serverAddress = 11;     // Server address
    repeated RealWorldDataPathPatternFormat extendedPathPatternFormats = 12;  // Extended path pattern formats
    repeated RealWorldDataTags tags = 13;
}

message RealWorldDataRegisterDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;
    repeated RealWorldDataTags tags = 5;
}

message RealWorldDataRegisterSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;
    optional string status = 5;
    repeated RealWorldDataTags tags = 6;
}

message RealWorldDataCollectionDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataCollectionInfo collectionInfo = 4;
    repeated RealWorldDataTags tags = 5;
}

message RealWorldDataCollectionSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataCollectionInfo collectionInfo = 4;
    optional string status = 5;
    repeated RealWorldDataTags tags = 6;
}

message RealWorldDataCollectionStatus {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataCollectionInfo collectionInfo = 4;
    optional string contentReferenceTime = 5;
    repeated google.protobuf.Struct activeConnections = 6;
    repeated google.protobuf.Struct trafficStatistics = 7;
    repeated RealWorldDataTags tags = 8;
}

message RealWorldDataBrewingDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataBrewerInfo brewerInfo = 4;
    repeated RealWorldDataBrewerInput brewerInput = 5;
    repeated RealWorldDataBrewingArgument brewingArgument = 6;
    repeated RealWorldDataStoringInfo brewerOutputStore = 7;
    optional string timePeriodStart = 8;                    // Start time of the data to be read
    optional string timePeriodEnd = 9;                      // End time of the data to be read
    repeated RealWorldDataTags tags = 10;
}

message RealWorldDataBrewingSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataBrewerInfo brewerInfo = 4;
    repeated RealWorldDataBrewerOutput brewerOutput = 5;
    repeated RealWorldDataBrewingArgument brewingArgument = 6;
    optional string timePeriodStart = 7;                    // Start time of the data to be read
    optional string timePeriodEnd = 8;                      // End time of the data to be read
    repeated RealWorldDataTags tags = 9;
}

message RealWorldDataPeriodicBrewingConfig {                // Configuration for the RWDB system to periodically issue RealWorldDataBrewingDemand
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataBrewingDemand brewingConfig = 4;  // Demand to be issued
    optional string cronConfig = 5;                         // Time interval (cron format)
    optional bool enabled = 6;
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataReadDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;                  // Real-world dataset to be read
    optional string timePeriodStart = 5;                    // Start time of the data to be read
    optional string timePeriodEnd = 6;                      // End time of the data to be read
    optional string sparqlQuery = 7;                        // Structural query (SPARQL)
    optional string graphqlQuery = 8;                       // Structural query (GraphQL)
    repeated RealWorldDataTags tags = 9;
}

message RealWorldDataReadSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;                  // Real-world dataset to be read
    optional string timePeriodStart = 5;                    // Start time of the data to be read
    optional string timePeriodEnd = 6;                      // End time of the data to be read
    optional string sparqlQuery = 7;                        // Structural query (SPARQL)
    optional string graphqlQuery = 8;                       // Structural query (GraphQL)
    optional bytes data = 9;                                // Actually sent via MBUS?
    repeated RealWorldDataTags tags = 10;
}

message RealWorldDataWriteDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;                  // Real-world dataset to be written
    optional string timePeriodStart = 5;                    // Start time of the data to be written
    optional string timePeriodEnd = 6;                      // End time of the data to be written
    optional bytes data = 7;                                // Actually sent via MBUS?
    repeated RealWorldDataTags tags = 8;
}

message RealWorldDataWriteSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;
    optional string timePeriodStart = 5;                    // Start time of the written data
    optional string timePeriodEnd = 6;                      // End time of the written data
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataMoveDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;                  // RealWorldDataset to be moved
    optional string timePeriodStart = 5;                    // How far back in time the start of the data to be moved should be (e.g., 8d → 8 days ago)
    optional string timePeriodEnd = 6;                      // How far back in time the end of the data to be moved should be (e.g., 7d → 7 days ago)
    optional RealWorldDataStoringInfo moveFrom = 7;         // Source location of the data
    optional RealWorldDataStoringInfo moveTo = 8;           // Destination for the data
    repeated RealWorldDataTags tags = 9;
}

message RealWorldDataMoveSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataset dataset = 4;                  // Moved RealWorldDataset
    optional string timePeriodStart = 5;                    // How far back in time the start of the moved data should be (e.g., 8d → 8 days ago)
    optional string timePeriodEnd = 6;                      // How far back in time the end of the moved data should be (e.g., 7d → 7 days ago)
    optional RealWorldDataStoringInfo moveFrom = 7;         // Source location of the data
    optional RealWorldDataStoringInfo moveTo = 8;           // Destination for the data
    optional RealWorldDataset movedDataset = 9;             // RealWorldDataset at the destination
    repeated RealWorldDataTags tags = 10;
}

message RealWorldDataPeriodicMoveConfig {                   // Configuration for the RWDB system to periodically move RealWorldDataset
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataMoveDemand moveConfig = 4;        // Move configuration
    optional string cronConfig = 5;                       // Time interval (cron format)
    optional bool enabled = 6;
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataRemoveDemand {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataStoringInfo datasetStore = 4;     // RealWorldDataStoringInfo of the RealWorldDataset to be removed
    optional string timePeriodStart = 5;                    // How far back in time the start of the data to be removed should be (e.g., 8d → 8 days ago)
    optional string timePeriodEnd = 6;                      // How far back in time the end of the data to be removed should be (e.g., 7d → 7 days ago)
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataRemoveSupply {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataStoringInfo datasetStore = 4;     // RealWorldDataStoringInfo of the removed RealWorldDataset
    optional string timePeriodStart = 5;                    // How far back in time the start of the removed data was (e.g., 8d → 8 days ago)
    optional string timePeriodEnd = 6;                      // How far back in time the end of the removed data was (e.g., 7d → 7 days ago)
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataPeriodicRemoveConfig {                 // Configuration for the RWDB system to periodically remove RealWorldDataset
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional RealWorldDataRemoveDemand removeConfig = 4;    // Remove configuration
    optional string cronConfig = 5;                       // Time interval (cron format)
    optional bool enabled = 6;
    repeated RealWorldDataTags tags = 7;
}

message RealWorldDataPathPatternFormat {
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string pattern = 4;                            // Path pattern before replacement
    optional string datasetProperty = 5;                    // Key name in dbp:tags (within RealWorldDataset) to be replaced
    repeated RealWorldDataTags tags = 6;
}

message RealWorldDataTags {                                 // Represents extended properties for RealWorldData*
    optional string id = 1;
    optional string name = 2;
    optional string url = 3;
    optional string key = 4;                                // Tag key
    optional string value = 5;                              // Tag value
}
